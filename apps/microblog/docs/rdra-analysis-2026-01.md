# RDRA要求分析レポート

**分析日**: 2026-01-24
**対象**: iori (庵) - 分散型マイクロブログサービス

---

## 1. 分析の目的

RDRAに基づいた要求分析を通じて、現在の設計に潜在的な欠陥がないかを検証する。

---

## 2. システム価値レイヤーの分析

### 2.1 発見された問題: ビジネス目的の不明確さ

**現状**: SPEC.mdにはプロダクト概要・ユースケース・機能仕様が記載されているが、「なぜこのシステムを作るのか」が明文化されていない。

**問題点**:

- ビジネスユースケース（BUC）の欠落
- ステークホルダーの要求（Requirements）が未定義
- 成功の判断基準がない

### 2.2 実装から推測したシステム価値

| BUC ID | ビジネスユースケース         | 説明                                    |
| ------ | ---------------------------- | --------------------------------------- |
| BUC-01 | 個人の発信基盤を持つ         | 大規模SNSに依存しない自分だけの発信場所 |
| BUC-02 | 小規模コミュニティを運営する | 少人数で親密なコミュニケーション        |
| BUC-03 | 短文と長編を統合する         | マイクロブログ + 手記（後述）の統合     |

### 2.3 推測した要求

| REQ ID | ステークホルダー | 要求                       | 実装との対応     |
| ------ | ---------------- | -------------------------- | ---------------- |
| REQ-01 | ローカルユーザー | 自分のサーバーで発信したい | セルフホスト可能 |
| REQ-02 | ローカルユーザー | Fediverseと繋がりたい      | ActivityPub対応  |
| REQ-03 | ローカルユーザー | 思考の断片を残したい       | 投稿 + 手記      |
| REQ-04 | サーバー管理者   | 運用コストを抑えたい       | 軽量設計（Hono） |

### 2.4 推奨アクション

- [ ] ビジネスユースケースと要求をドキュメント化する
- [ ] 成功指標（KPI）を定義する
- [ ] ターゲットユーザーのペルソナを明確化する

---

## 3. Article機能の分析

### 3.1 発見された問題: 名前と実態の不一致

**現状の設計**:

- `Article`という名前で「スレッドのまとめ」機能を実装
- `rootPostId`で既存のPostスレッドを参照
- 内容は動的に取得（スナップショットではない）

**問題点**:

- 「Article（記事）」という名前は体系化された文書を想起させる
- 実際の機能はZennのスクラップのような「思考の断片の集積」
- 名前と実態の乖離がユーザーの期待と異なる機能を生む恐れ

### 3.2 概念の整理

| 概念                | 説明                     | 例              |
| ------------------- | ------------------------ | --------------- |
| Note（投稿）        | 短い発言、単発の思いつき | Tweet、Toot     |
| Thread（スレッド）  | 投稿の連鎖、会話         | Twitterスレッド |
| Scrap（スクラップ） | 思考の断片の集積         | Zennスクラップ  |
| Article（記事）     | 体系化された文書         | ブログ記事      |

現在の「Article」機能の実態は**Scrap**に近い。

### 3.3 解決策: 「手記（Shuki）」への改名

iori（庵）のコンセプト（小さな隠れ家で静かに思索する場所）と相性の良い和風の命名として「手記」を採用。

**手記の定義**:

> 自分の手で書き残す個人的な記録。
> スレッド（投稿の連鎖）を「まとめ」として公開する機能。
> 体系化された記事ではなく、思考の軌跡。

### 3.4 命名変更の影響範囲

| 箇所           | 変更内容                           |
| -------------- | ---------------------------------- |
| ドメインモデル | `Article` → `Shuki`                |
| DBテーブル     | `articles` → `shukis`              |
| ユースケース   | `createArticle` → `createShuki` 等 |
| UIラベル       | 「記事」 → 「手記」                |
| ActivityPub    | 検討要（Articleオブジェクト）      |

---

## 4. 集約設計の検討

### 4.1 現状の問題点

```
Article --rootPostId--> Post (1:1参照)

問題点:
1. 集約間の強い結合（Post削除 → Article削除）
2. ライフサイクルの不一致
3. Articleがcontentを持たない（動的取得）
```

### 4.2 検討した代替案

| 案                    | 説明                 | 評価             |
| --------------------- | -------------------- | ---------------- |
| A. 現状維持           | スレッドのメタデータ | 実態と合っている |
| B. 独立型             | 独自のcontent持つ    | Post機能と重複   |
| C. Post拡張型         | contentType追加      | 概念はシンプル   |
| D. スナップショット型 | 公開時に内容固定     | 同期が複雑       |

### 4.3 結論

現時点では**案A（現状維持）**が実態に合っている。
ただし、将来的に「体系化された記事」機能が必要になった場合は**案B（独立型）**を別機能として追加することを検討。

---

## 5. 今後の検討課題

### 5.1 優先度: 高

| # | 課題                         | 説明                       |
| - | ---------------------------- | -------------------------- |
| 1 | Article → 手記への改名       | UIラベル、コード、DBの変更 |
| 2 | システム価値のドキュメント化 | BUC、要求、KPIの明文化     |

### 5.2 優先度: 中

| # | 課題                      | 説明                                      |
| - | ------------------------- | ----------------------------------------- |
| 3 | 他のRDRAレイヤー分析      | 外部環境、境界、情報モデル                |
| 4 | ActivityPubでの表現見直し | NoteスレッドをArticleとして配信する妥当性 |

### 5.3 優先度: 低

| # | 課題                 | 説明                           |
| - | -------------------- | ------------------------------ |
| 5 | 体系化された記事機能 | 将来的に必要になった場合に検討 |

---

## 6. 付録: RDRAレイヤー概要

```
┌─────────────────────────────────────────────────────────────┐
│                    システム価値                              │
│  ビジネスユースケース、要求、KPI                             │
├─────────────────────────────────────────────────────────────┤
│                    システム外部環境                          │
│  アクター、外部システム、ビジネスプロセス                    │
├─────────────────────────────────────────────────────────────┤
│                    システム境界                              │
│  ユースケース、入出力                                        │
├─────────────────────────────────────────────────────────────┤
│                    システム                                  │
│  機能、情報モデル、状態モデル                                │
└─────────────────────────────────────────────────────────────┘
```

---

## 改訂履歴

| 日付       | バージョン | 変更内容 |
| ---------- | ---------- | -------- |
| 2026-01-24 | 1.0        | 初版作成 |
