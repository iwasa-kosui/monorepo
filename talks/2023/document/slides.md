---
theme: ../../themes/kosui
title: 更新"しない"ドキュメント管理 「イミュータブルドキュメントモデル」の実運用
class: text-center
highlighter: shiki
drawings:
  persist: true
mdc: true

talk:
  date: "2023-12-06"
  event: "Findy様 ドキュメント管理を制する 陳腐化を防ぐための実践事例 Lunch LT"
  description: |
    ドキュメントを更新し続ける代わりに、意思決定を記録する「イミュータブルドキュメントモデル」の実運用について紹介します。
  tags:
    - Documentation
    - Team Practice
  duration: "20min"
  speaker: "岩佐 幸翠"
---

# 更新"しない"ドキュメント管理<br/> 「イミュータブルドキュメントモデル」の実運用

**kosui (@kosui_me)**

---

# 自己紹介

<div class="flex gap-32">

<div>

![icon](https://www.kosui.me/_next/image/?url=%2Ficon.png&w=256&q=100)

## kosui (岩佐 幸翠)

X / Twitter:
@kosui_me

</div>

<div>
<div class="flex">

<div>

### 株式会社カケハシ
(2022/08-現在)

社内プラットフォームシステムの開発・運用

- 認証認可基盤
- 組織アカウント管理サービス

</div>

</div>

### 株式会社ディー・エヌ・エー
(2019/04-2022/08)

- タクシー配車アプリ「GO」(当時MOV)
- 認証認可基盤

</div>

</div>

---

# 「現在の仕様や設計」の考古学あるある

## 1. 謎の仕様を見つける
「おや、ここはなぜこの仕様になったんだ」
何かを意図してこの仕様?  特に何も考えずこの仕様?

## 2. ドキュメントを探す
「こんなに丁寧で詳細なドキュメントが！」

## 3. 何もわからないことが分かる
しかし、よく見ると記事の作成日は古く
中途半端に更新されているが知りたいことは書いてない
「結局、何でこの仕様になったの?」

---

# ドキュメントの悪循環

## 悪貨は良貨を駆逐する

<img src=/loop.svg class="mx-auto mb-8" />

## "天才的"な発想

「じゃあ、最新の仕様・設計とその背景を全部書けばいいんだ！」
「全ての開発プロセスにドキュメント執筆を義務化して...」

---

# 「最新の仕様・設計」を更新し続けるのは不可能

<img src=/cart-arrow.svg class="m-0" />

---

# 意思決定に目を向ける

## 最新の仕様・設計は意思決定の積み重ね

仕様・設計は変化していくが、それを決めた当時の意思決定は不変

<img src=/mutable-vs-immutable.svg />

## 不変である「意思決定」を中心に記録する

意思決定の記録は、後から更新する必要がなく、仕様や設計の背景を端的に示せる

> 「結局、何でこの仕様になったの?」

---

# イミュータブルドキュメントモデル

イミュータブルデータモデルから影響を受けたドキュメント管理の考え方

<img src="/immutable-document-model.svg" class="mb-8 w-[700px]" />

- 継続して更新すべき「可変なドキュメント」をできるだけ減らし
  それらの元となる意思決定を「不変なドキュメント」として記録する
- 「なぜこの仕様にしたのか」「設計にあたって何を検討したのか」という
  重要な情報は後世に残しつつ、ドキュメントの運用負荷を低減させる

---

# イミュータブルドキュメントモデル① 不変な情報

## **意思決定**を**不変な情報**としてドキュメントにする

合意したら合意日を明記し、その後は更新しない

<img src=/decision.svg class="my-4" />

---

# イミュータブルドキュメントモデル② 可変な情報

## **仕様・設計**は**可変な情報**としてドキュメントにする

<div class="flex flex-nowrap">
<div class="w-[55%]">

<img src=/mutable.svg />

</div>
<div class="flex-1">

- 大前提: なるべく書かない
- あくまで意思決定の要約として記述
- 関連する意思決定を冒頭で明示

</div>
</div>

---
layout: section
---

# 運用上の課題と解決策

---

# 運用上の課題

<img src=/problems.svg />

---

# 課題① テンプレ埋めが目的化しがち

## PRDやDesign Docは目的に対して重厚な時も

意思決定を記録する上でPRDやDesign Docは有用な手法
しかし、意思決定の規模によってはもっと手軽に書きたい

例) PRDの「競合分析」に「特になし」と書きがち

## Decision Record

ADRをベースとした、非常に軽量な意思決定の記録手法

- 背景: なぜその意思決定を下すか
- 決定: 何を決定したのか
- 影響: 決定による影響は何か

問題提起の時点で「背景」から記述しチーム内の認識合わせに利用
MTGで「それDRにしましょう！」「DR書いたらそれベースでMTGしましょう」と声掛け

---

# 運用事例 (弊チームの場合)

<div class="flex gap-16">
<div>

## ディレクトリ構成
<img src=/tree.svg class="m-0" />

</div>
<div>

## 比率
基本的には意思決定をDecision Recordで記録している

<img src=/chart.svg class="m-0 w-[90%]" />

</div>
</div>

---

# 課題② 誰がいつレビューしたか分からない

## 「この記事にある話、結局どうなったの?」

当初はSlackでレビューコメントをしていた
過去の意思決定の記事は「これ、結局合意したの？してないの？」になりがち

## 一目でわかる意思決定のステータス

ドキュメントのテンプレートを変更し
記事の冒頭にてステータス・承認日・関係者が分かるように

---

# まとめ

<img src="/immutable-document-model.svg" class="w-[600px] mb-4" />

## 運用のコツ

- 意思決定を記録するハードルを下げる
  - 軽量なドキュメント手法「Decision Record」
  - 問題提起のタイミングから書き始めて認識合わせに用いる
- 意思決定を理解するハードルを下げるため、意思決定のステータスを明示する
- 可変なドキュメントはなるべく増やさない
